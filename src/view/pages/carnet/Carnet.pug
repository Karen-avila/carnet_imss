.layout.q-mx-auto.q-mb-xl.q-pa-md
  template(v-if="currentUser.pacientes")
    span.text-h4 Carnet
    q-separator(color='grey-4' size='2px')
    q-separator.q-mb-lg(
      color='secondary'
      size='.5rem'
      style='max-width:2.5rem'
    )
    q-form.q-col-gutter-y-md(v-if="currentUser.pacientes.length === 0")
      p.q-mt-md INGRESA LOS DATOS DEL PACIENTE
        .row.q-col-gutter-md
          .col-md-6.col-12.self-end
            label Nombre (s):
            q-input(
              outlined=''
              dense=''
              v-model='form.nombre_paciente'
              placeholder='Ingresa el nombre'
              lazy-rules=''
            )
          .col-md-3.col-12.self-end
            label Primer apellido:
            q-input(
                outlined=''
                dense=''
                v-model='form.ap_paterno_paciente'
                placeholder='Ingresa el apellido'
                lazy-rules=''
              )
          .col-md-3.col-12.self-end
            label Segundo apellido:
            q-input(
                outlined=''
                dense=''
                v-model='form.ap_materno_paciente'
                label='Ingresa el apellido'
                lazy-rules=''
              )
        .row.q-col-gutter-md
          .col-md-3.col-12.self-end
            label Clave única de registro de población (CURP):
            q-input(
              outlined=''
              dense=''
              v-model='form.curp'
              label='Ingresa la CURP'
              lazy-rules=''
              style="width:100%"
            )
          .col-md-3.col-12.self-end
            label Delegación:
            q-select(
              outlined=''
              dense=''
              v-model='form.delegacion'
              placeholder='Selecciona la delegación'
              use-input=''
              hide-selected=''
              fill-input=''
              input-debounce='0'
              :options='options.delegacion'
              @filter='filterFndelegacion'
            )
              template(v-slot:no-option='')
                q-item
                  q-item-section.text-grey
                    | No hay coincidencias
          .col-md-6.col-12.self-end
            label Unidad médica:
            q-select(
              outlined=''
              dense=''
              v-model='form.denominacion_unidad_atencion'
              placeholder='Selecciona la unidad'
              use-input=''
              hide-selected=''
              fill-input=''
              input-debounce='0'
              :options='options.denominacion_unidad_atencion'
              @filter='filterFndenominacion_unidad_atencion'
              style="width:100%"
            )
              template(v-slot:no-option='')
                q-item
                  q-item-section.text-grey
                    | No hay coincidencias
        .row.q-col-gutter-md
          .col-md-4.col-12.self-end
            label Número de seguro social (NSS):
            q-input(
              outlined=''
              dense=''
              v-model='form.nss'
              placeholder='Ingresar NSS'
              lazy-rules=''
              style="width:100%"
            )
          .col-md-8.col-12.self-end
            label Diagnóstico:
            q-select(
              outlined=''
              dense=''
              v-model='form.diagnostico_cie10'
              placeholder='Selecciona el diagnóstico'
              use-input=''
              hide-selected=''
              fill-input=''
              input-debounce='0'
              :options='options.diagnostico_cie10'
              @filter='filterFndiagnostico_cie10'
            )
              template(v-slot:no-option='')
                q-item
                  q-item-section.text-grey
                    | No hay coincidencias
        .row.q-col-gutter-xl
          .col-12
            div.q-mt-md.text-right
              q-btn.text-capitalize(
                label='Limpiar'
                color='grey-6'
                outline=''
                style='min-width: 150px'
                @click='reset'
              )
              q-btn.q-ml-lg.text-capitalize(
                :loading='searching'
                color='accent'
                outline=''
                ref='searchPatient'
                @click='search'
                style='min-width: 150px'
              )
                | {{pacientes.length === 0 ? "Buscar" : "Buscar"}}
                template(v-slot:loading='')
                  q-spinner-hourglass.on-left
                  | Buscando...
  template
    q-banner.bg-amber-2.text-center.q-mb-md.shadow-4(
      inline-actions=''
      rounded=''
      dense=''
      v-if='!paciente && !noResults'
    )
      span.text-weight-bold {{pacientes.length ? `${pacientes.length} Paciente(s) encontrados` : 'Busca un paciente para ver los resultados'}}
      template(v-if="pacientes.length")
        br
        span.text-caption Selecciona un registro para ver detalles
    q-banner.bg-negative.text-center.alert-negative.q-mb-md.shadow-4.text-white(
      inline-actions=''
      rounded=''
      dense=''
      v-if='noResults'
    )
      span.text-weight-bold No se encontraron pacientes relacionados
    q-table(
      v-if='pacientes.length'
      :data='pacientes'
      :columns='columns'
      row-key='name'
      flat=''
      bordered=true
      :dense='$q.screen.lt.md'
      :rows-per-page-options='[10, 25, 50]'
      :pagination-label="paginationLabel"
      rows-per-page-label='Pacientes por página'
      separator='cell'
      class="carnet-header-table"
    )
      template(v-slot:body-cell='props')
        q-td.cursor-pointer(:props='props' @click='setPatient(props.row)')
          span(v-if="props.col.field === 'nombre_paciente'") {{props.value}} {{props.row.ap_paterno_paciente}} {{props.row.ap_materno_paciente}}
          span(v-else-if="props.col.field === 'edad'") {{props.value}} años
          span(v-else-if="props.col.field === 'actions'")
            q-icon(name='person_search' size='md', color='accent')
          span(v-else) {{props.value}}
    template(v-if="paciente")
      .row.q-mb-xl.q-col-gutter-x-xl.bg-carnet.q-col-gutter-y-md
        .col-md-10.col-12.q-col-gutter-y-lg
          .row.q-col-gutter-x-lg.q-col-gutter-y-md
            .col-md-6.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section(avatar='')
                    q-avatar(color='blue-1')
                      img.q-mt-xs(src='@/assets/img/carnet/Vector0.png')
                  q-item-section
                    q-item-label(caption='') Nombre
                    q-item-label {{paciente.nombre_paciente}} {{paciente.ap_paterno_paciente}} {{paciente.ap_materno_paciente}}
                    q-item-label(caption='') Fecha de nacimiento
                    q-item-label {{paciente.fecha_nacimiento | DateTime}}
            .col-md-6.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section(avatar='')
                    q-avatar(color='blue-1', text-color='white')
                      img.q-mt-xs(src='@/assets/img/carnet/Vector1.png')
                  q-item-section
                    q-item-label(caption='') NSS
                    q-item-label {{paciente.nss}}
                    q-item-label(caption='') Agregado Médico
                    q-item-label {{paciente.agregado_medico}}
          .row.q-col-gutter-x-lg.q-col-gutter-y-md
            .col-md-4.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section(avatar='')
                    q-avatar(color='cyan-1', text-color='white')
                      img.q-mt-xs(src='@/assets/img/carnet/Vector2.png')
                  q-item-section
                    q-item-label(caption='') CURP
                    q-item-label {{paciente.curp}}
            .col-md-4.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section(avatar='')
                    q-avatar(color='yellow-1', text-color='white')
                      img.q-mt-xs(src='@/assets/img/carnet/Vector3.png')
                  q-item-section
                    q-item-label(caption='') Edad
                    q-item-label {{paciente.edad}} años
            .col-md-4.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section(avatar='')
                    q-avatar(color='green-1', text-color='white')
                      img.q-mt-xs(src='@/assets/img/carnet/Vector4.png')
                  q-item-section
                    q-item-label(caption='') Peso
                    q-item-label {{paciente.peso}} Kg
          .row.q-col-gutter-x-lg.q-col-gutter-y-md
            .col-md-8.col-12
              q-card.q-py-sm.shadow-4.b-ra-12
                q-item
                  q-item-section
                    q-item-label(caption='') Diagnóstico
                    q-item-label {{paciente.diagnostico_cie10}}
                    q-item-label(caption='') Información
                    q-item-label Tipo de mezcla: {{paciente.tipo_mezcla}}
            .col-md-4.col-12
              q-card.q-py-sm.bg-green-11.b-ra-12.shadow-4
                q-item
                  q-item-section
                    q-item-label La información de los medicamentos proviene de centros de mezcla subrogados
        .col-md-2.col-12(:class="`${$q.screen.xs || $q.screen.sm ? 'order-first': ''}`")
          q-card.b-ra-12.q-mx-auto.transparent(
            flat=''
            bordered=false
            style="max-width:200px"
          )
            img.q-mx-auto(
              src='@/assets/img/carnet/kid.png'
              style="max-width:275px; max-heigth:275px;"
            )
      q-list.q-mb-md.b-ra-12.shadow-4(
        bordered=''
        v-for='(carnet, i) in carnets'
        :key='i'
      )
        q-expansion-item.b-ra-12.bg-grey-2(
          group='somegroup'
          icon='explore'
        )
          template(v-slot:header='')
            .col
              q-item-section
                p.no-margin Unidad de atención
                p.no-margin.text-grey-7.text-weight-bold
                  | {{carnet.denominacion_unidad_atencion ? carnet.denominacion_unidad_atencion : '-'}}
                  br
                  | {{carnet.unidad_medica_atencion ? carnet.unidad_medica_atencion : '-'}}
            .col(:class="`${$q.screen.xs || $q.screen.sm ? 'hidden': ''}`")
              q-item-section
                p.no-margin Médico
                p.no-margin.text-grey-7.text-weight-bold {{carnet.medico ? carnet.medico : '-'}}
            .col(:class="`${$q.screen.xs || $q.screen.sm ? 'hidden': ''}`")
              q-item-section
                p.no-margin Cama
                p.no-margin.text-grey-7.text-weight-bold {{carnet.cama && carnet.cama != 0 ? carnet.cama : '-'}}
            .col(:class="`${$q.screen.xs || $q.screen.sm ? 'hidden': ''}`")
              q-item-section
                p.no-margin Fecha
                p.no-margin.text-grey-7.text-weight-bold {{`${carnet.fecha_prescripcion ? carnet.fecha_prescripcion : '-'}` | DateTime}}
          row.bg-yellow-2(:class="`${$q.screen.xs || $q.screen.sm ? '': 'hidden'}`")
            .col.q-px-md.q-pb-md
              p.no-margin Médico
              p.no-margin.text-grey-7.text-weight-bold {{carnet.medico ? carnet.medico : '-'}}
              p.no-margin Cama
              p.no-margin.text-grey-7.text-weight-bold {{carnet.cama && carnet.cama != 0 ? carnet.cama : '-'}}
              p.no-margin Fecha
              p.no-margin.text-grey-7.text-weight-bold {{`${carnet.fecha_prescripcion ? carnet.fecha_prescripcion : '-'}` | DateTime}}
          q-markup-table(
            flat=''
            bordered=true
            separator='cell'
          )
            .col(:class="`${$q.screen.xs || $q.screen.sm ? 'hidden': ''}`")
            thead.bg-yellow-2
              tr
                th.text-center ID Preescripción
                th.text-center Genérico
                th.text-center Consumo
                th.text-center Cantidad
                th.text-center Tipo
                th.text-center Estatus
            tbody
              tr(
                v-for='(prescription, p) in carnet.carnet', :key='p'
                v-if='prescription.tipo !== "Instrumental Médico"'
              )
                td.text-center {{prescription.id_prescripcion}}
                td.text-center {{prescription.generico}}
                td.text-center {{prescription.consumo}} {{prescription.unidad_medida}}
                td.text-center {{prescription.cantidad_bolos}}
                td.text-center {{prescription.tipo}}
                td.text-center(
                  :class='{"bg-red-1": prescription.entregado === "NO ENTREGADO", "bg-green-11": prescription.entregado === "ENTREGADO"}'
                )
                  span(
                    :class='{ "text-negative": prescription.entregado === "NO ENTREGADO", "text-green-8": prescription.entregado === "ENTREGADO" }'
                  ) {{prescription.entregado ? prescription.entregado : '-' | Capitalize}}
